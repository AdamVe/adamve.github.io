<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--
Trial for IdentityInCanMakePaymentEventFeature:
Remove the merchant origin and arbitrary data from the "canmakepayment" service worker event.

Origin: romantic-dirt-jaguar.glitch.me
Third party: Yes

Available: Chrome 108 to 110.
End date: Apr 4, 2023.

https://developer.chrome.com/origintrials/#/view_trial/3462142213541068801
https://chromestatus.com/feature/5190978431352832
-->
<meta http-equiv="origin-trial" content="A3y8Vvmzq5EnUo8e2hI/xw4TvW0UFaDHFaEnErWfr/icd/tfRLTk+65eeNu6kqgy/8ZoFIXZ/m9WMQZpP14hzgEAAACQeyJvcmlnaW4iOiJodHRwczovL3JvbWFudGljLWRpcnQtamFndWFyLmdsaXRjaC5tZTo0NDMiLCJmZWF0dXJlIjoiSWRlbnRpdHlJbkNhbk1ha2VQYXltZW50RXZlbnRGZWF0dXJlIiwiZXhwaXJ5IjoxNjgwNjUyNzk5LCJpc1RoaXJkUGFydHkiOnRydWV9">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Test for the "canmakepayment" identity Origin Trial</title>
<link rel="icon" href="/favicon.ico">
<link rel="stylesheet" type="text/css" href="../../style.css">
<script src="/pr/util.js"></script>
</head>
<body onload="startUp()">
<div id="contents">
<h1>Test for the "canmakepayment" identity Origin Trial</h1>

<p>This is a test for a Payment Handler with an <a
href="https://developer.chrome.com/origintrials/#/view_trial/3462142213541068801">Origin
Trial</a> that <a
href="https://chromestatus.com/feature/5190978431352832">removes identity in
<code>"canmakepayment"</code> event</a>. Click <code>[Run a test]</code> to see
a response from the Payment Handler.</p>

<ul>

<li>First run: Chrome installs the Payment Handler just-in-time and does not
trigger its <code>"canmakepayment"</code> event. The Payment Handler response
will specify <code>"canMakePaymentRan": false</code>.

<li>Consequent runs: Chrome triggers the <code>"canmakepayment"</code> event in
the Payment Handler. Its response will include <code>"canMakePaymentRan":
true</code>.

</ul>

<p>To see the origin trial token on the Payment Handler:</p>
<pre>
  $ curl --head https://romantic-dirt-jaguar.glitch.me/sw.js | grep origin-trial
  origin-trial: A3y8Vvmzq5EnUo8e2hI/xw4TvW0UFa...
</pre>

<p>To manually remove identity from <code>"canmakepayment"</code> event, set
<code>chrome://flags/#clear-identity-in-can-make-payment</code> to
<code>[Enabled]</code> and restart Chrome.</p>

<button onclick="runTest()">Run a test</button>
<pre id="msg"></pre>
</div>
<script>
let request = null;

function init() {
  request = new PaymentRequest([{supportedMethods:
    'https://romantic-dirt-jaguar.glitch.me/pay'}], {total: {label: 'Total',
    amount: {value: '0.01', currency: 'USD'}}});
  info('Initialized');
}

async function checkCanMakePayment() {
  try {
    info(await request.canMakePayment() ? 'Can make payment' : 'Cannot make payment');
  } catch (e) {
    error(e);
    init();
  }
}

async function runTest() {
  try {
    const response = await request.show();
    response.complete('success');
    info(JSON.stringify(response, undefined, 2));
    init();
  } catch (e) {
    error(e);
    init();
  }
}

function startUp() {
  window.setTimeout(() => {
    init();
    checkCanMakePayment();
  }, 500);
}
</script>
</body>
</html>
