<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--
     - Origin trial for secure payment confirmation:
     - https://developers.chrome.com/origintrials/#/view_trial/42784196460019713
     -->
  <meta http-equiv="origin-trial" content="Ajn0hFFf7nvHq6WtQTtaVPHYWcNKkItmhE1awHmbTjoKnorOCsPYTkCurP1ZyVhryBQMWFLE+wtnBb1Z5XtFfQ0AAABoeyJvcmlnaW4iOiJodHRwczovL3Jzb2xvbWFraGluLmdpdGh1Yi5pbzo0NDMiLCJmZWF0dXJlIjoiU2VjdXJlUGF5bWVudENvbmZpcm1hdGlvbiIsImV4cGlyeSI6MTYwMjI0MDIyMX0=">

  <title>Secure Payment Confirmation</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" type="text/css" href="../style.css">
</head>

<body>
  <div id="contents">
    <h1>Secure Payment Confirmation</h1>
    <p>This is a test website. Nothing is charged. Clicking "Enroll Credential" creates a new
      credential and passes it to the cross-origin iframe. Then clicking "Pay $0.01" in the iframe
      creates a Secure Payment Confirmation request with the given credential. This tests two things,
      (1) that the iframe can activate the SPC UI, and (2) that the iframe's SPC request can exercise
      an existing credential that was created in a different frame.</p>
    <p><button onclick="createPaymentCredential()">Enroll Credential</button></p>
    <iframe id="checkout" src="https://emerald-spiced-psychology.glitch.me/" allow="payment"></iframe>
  </div>
  <pre id="msg"></pre>
  <p><em>Enroll Credential</em> will make the following request:
  <pre style="color: #265289">const instrument = {
  displayName: 'Troy 路路路路',
  icon: 'https://rsolomakhin.github.io/pr/spc/troy.png',
};
const rp = {
  id: 'rsolomakhin.github.io',
  name: 'Rouslan Solomakhin',
};
const pubKeyCredParams = [{
  type: 'public-key',
  alg: -7,
}];
const payment = {
  rp,
  instrument,
  challenge: textEncoder.encode('Transaction approval challenge'),
  pubKeyCredParams,
};
const publicKeyCredential = await navigator.credentials.create({payment});
const credentialString = btoa(String.fromCharCode(...new Uint8Array(publicKeyCredential.rawId)));
document.getElementById("checkout").contentWindow.postMessage(
  credentialString,
  "https://emerald-spiced-psychology.glitch.me/");</pre></p>
  <p>Based on the <a
  href="https://github.com/rsolomakhin/secure-payment-confirmation">Secure
  Payment Confirmation explainer</a>.</p>
  <script src="../util.js"></script>
  <script src="pr.js"></script>
  <script src="/redirect.js"></script>
</body>

</html>
